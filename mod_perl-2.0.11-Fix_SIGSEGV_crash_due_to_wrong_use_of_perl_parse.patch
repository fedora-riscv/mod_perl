------------------------------------------------------------------------
r1886793 | stevehay | 2021-02-22 15:22:21 +0100 (Po, 22 Ãºno 2021) | 3 lines

Fix SIGSEGV crash due to wrong use of perl_parse()

Patch by Charles Pigott <cpigott@rapitasystems.com>.

Index: src/modules/perl/modperl_config.c
===================================================================
--- src/modules/perl/modperl_config.c	(revision 1886792)
+++ src/modules/perl/modperl_config.c	(revision 1886793)
@@ -163,7 +163,8 @@
     scfg->PerlPostConfigRequire =
         apr_array_make(p, 1, sizeof(modperl_require_file_t *));
 
-    scfg->argv = apr_array_make(p, 2, sizeof(char *));
+    /* 2 arguments + NULL terminator */
+    scfg->argv = apr_array_make(p, 3, sizeof(char *));
 
     scfg->setvars = apr_table_make(p, 2);
     scfg->configvars = apr_table_make(p, 2);
@@ -219,6 +220,9 @@
 
     *argc = scfg->argv->nelts;
 
+    /* perl_parse() expects a NULL terminated argv array */
+    modperl_config_srv_argv_push(NULL);
+
     MP_TRACE_g_do(dump_argv(scfg));
 
     return (char **)scfg->argv->elts;

------------------------------------------------------------------------
